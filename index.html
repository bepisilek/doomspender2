<!DOCTYPE html>
<html lang="hu" data-theme="light">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Munka√≥ra ‚Äî Ap√°dhelyett Any√°d üòè</title>
<style>
/* ============== THEME ============== */
:root {
  --bg-grad-1:#f7f9ff; --bg-grad-2:#eef2ff;
  --card:#ffffff; --text:#111827; --muted:#6b7280; --line:#e9eef7;
  --blue:#0b66ff; --green:#22c55e; --red:#ef4444; --yellow:#facc15;
  --radius:20px; --shadow:0 8px 20px rgba(2,6,23,.06);
}
html[data-theme="dark"] {
  --bg-grad-1:#0b1020; --bg-grad-2:#0f1530;
  --card:#121833; --text:#e9ecff; --muted:#aab2d6; --line:#283255;
  --shadow:0 14px 32px rgba(0,0,0,.45);
}

/* ============== RESET + BASE ============== */
* { box-sizing:border-box; }
html,body { height:100%; margin:0; padding:0; }
body {
  font-family:Inter, system-ui, sans-serif;
  background:linear-gradient(180deg,var(--bg-grad-1),var(--bg-grad-2));
  color:var(--text);
  display:flex; justify-content:center;
}
.wrap {
  width:100%; max-width:480px;
  padding:16px 14px 100px;
}

/* ============== HEADER ============== */
header { display:flex; justify-content:space-between; align-items:flex-start; gap:8px; }
h1 { font-size:26px; font-weight:800; margin:0; }
.subtitle { font-size:13px; color:var(--muted); margin:4px 0 0; line-height:1.3; }
.pill {
  background:rgba(11,102,255,0.1);
  color:var(--blue);
  padding:2px 8px;
  border-radius:999px;
  font-weight:600;
  font-size:11px;
}

/* ============== THEME TOGGLE ============== */
.switch { display:flex; align-items:center; gap:6px; }
.toggle {
  appearance:none;
  width:40px; height:22px;
  background:#cfd8ff44;
  border-radius:999px;
  position:relative;
  cursor:pointer;
}
.toggle::after {
  content:""; position:absolute; top:2px; left:2px;
  width:18px; height:18px;
  border-radius:50%;
  background:#fff;
  box-shadow:0 1px 3px rgba(0,0,0,.2);
  transition:left .2s ease;
}
.toggle:checked::after { left:20px; }

/* ============== TABS ============== */
.tabs {
  display:flex; justify-content:space-around;
  gap:6px; margin:10px 0 12px;
}
.tab {
  flex:1; border:none; border-radius:12px;
  background:#eaf0ff66;
  color:var(--text);
  font-weight:700; font-size:13px;
  padding:10px 0;
}
.tab.active {
  background:var(--blue); color:#fff;
  box-shadow:0 8px 20px rgba(11,102,255,.25);
}

/* ============== CARDS, INPUTS ============== */
.card {
  background:var(--card);
  border-radius:var(--radius);
  box-shadow:var(--shadow);
  padding:16px 14px;
  margin-bottom:16px;
}
h2 { text-align:center; color:var(--blue); margin:0 0 14px; font-size:17px; }

label { display:block; font-size:13px; color:var(--muted); margin-bottom:4px; }
input {
  width:100%; padding:11px 12px;
  border:1px solid var(--line);
  border-radius:12px;
  font-size:15px;
  background:transparent;
  color:var(--text);
}
input:focus {
  border-color:var(--blue);
  outline:none;
  box-shadow:0 0 0 2px rgba(11,102,255,.15);
}

/* ============== BUTTONS ============== */
.row { display:flex; gap:8px; margin-top:10px; }
.btn {
  flex:1; border:none; border-radius:12px;
  padding:12px 0; font-size:14px; font-weight:800;
  color:#fff; cursor:pointer;
}
.btn:hover { opacity:.9; }
.blue{background:var(--blue);}
.green{background:var(--green);}
.red{background:var(--red);}
.gray{background:#e5e7eb; color:#111;}
.yellow{background:var(--yellow); color:#111;}

/* ============== LIST ============== */
.list { list-style:none; padding:0; margin:6px 0 0; }
.item { display:flex; justify-content:space-between; align-items:center; padding:10px 0; border-bottom:1px solid var(--line); }
.badge { font-size:11px; border-radius:999px; padding:3px 6px; font-weight:700; }
.b-green { background:#dffbe7; color:#116a34; }
.b-red { background:#ffe4e4; color:#992323; }

/* ============== COACH ============== */
.bubble {
  position:fixed;
  bottom:80px; right:12px;
  max-width:260px;
  background:var(--blue);
  color:#fff;
  padding:12px 14px;
  border-radius:16px;
  box-shadow:0 8px 24px rgba(0,0,0,.3);
  font-size:13px;
}

/* ============== STATS CANVAS ============== */
canvas { width:100%; height:auto; border-radius:10px; }

/* ============== FOOTER ============== */
footer {
  text-align:center;
  font-size:12px;
  color:var(--muted);
  margin-top:8px;
}
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <h1>Munka√≥ra</h1>
        <p class="subtitle">Tudd, h√°ny √≥r√°t dolgozol a v√°gyaid√©rt. <span class="pill">+ Ap√°dhelyett Any√°d üòè</span></p>
      </div>
      <div class="switch">
        <span class="pill" id="modeLabel">Vil√°gos</span>
        <input id="themeToggle" class="toggle" type="checkbox" />
      </div>
    </header>

    <nav class="tabs">
      <button class="tab active" data-view="profile">Profil</button>
      <button class="tab" data-view="calc">Kalkul√°tor</button>
      <button class="tab" data-view="results">Eredm√©nyek</button>
      <button class="tab" data-view="stats">Statisztika</button>
    </nav>

    <!-- PROFILE -->
    <section id="view-profile" class="card">
      <h2>Profilod</h2>
      <div class="grid">
        <div>
          <label for="name">Becen√©v</label>
          <input id="name" type="text" placeholder="Add meg a beceneved" />
        </div>
        <div>
          <label for="age">Kor</label>
          <input id="age" type="number" min="1" placeholder="Add meg a korod" />
        </div>
        <div>
          <label for="salary">Nett√≥ havi fizet√©s (Ft)</label>
          <input id="salary" type="number" min="1" placeholder="pl. 450000" />
        </div>
        <div>
          <label for="hours">Heti munka√≥r√°k</label>
          <input id="hours" type="number" min="1" placeholder="pl. 40" />
        </div>
      </div>
      <div class="row">
        <button class="btn blue" id="saveProfile">Ment√©s</button>
        <button class="btn gray" id="deleteProfile">Profil t√∂rl√©se</button>
      </div>
      <p class="hint">Ment√©s ut√°n a Kalkul√°tor f√ºl√∂n sz√°molhatsz.</p>
    </section>

    <!-- CALCULATOR -->
    <section id="view-calc" class="card hidden">
      <h2>Kalkul√°tor</h2>
      <p class="center" id="hello">Szia! T√∂ltsd ki a profilod a pontos sz√°m√≠t√°shoz.</p>
      <div class="grid">
        <div>
          <label for="productName">Term√©k neve</label>
          <input id="productName" type="text" placeholder="pl. AirPods Pro" />
        </div>
        <div>
          <label for="productPrice">Term√©k √°ra (Ft)</label>
          <input id="productPrice" type="number" min="1" placeholder="pl. 79990" />
        </div>
      </div>
      <div class="row">
        <button class="btn yellow" id="calculateBtn">Kisz√°molom</button>
      </div>
      <div id="calcResult" class="hidden">
        <p class="center hint" id="hourlyHint"></p>
        <p class="center" style="font-weight:900;margin:10px 0 6px" id="workHoursText"></p>
        <div class="row">
          <button class="btn green" id="saveBtn">Megsp√≥rolom üíö</button>
          <button class="btn red" id="buyBtn">Megveszem üí∏</button>
        </div>
      </div>
    </section>

    <!-- RESULTS -->
    <section id="view-results" class="card hidden">
      <h2>Eredm√©nyek</h2>
      <div class="sum">
        <div><span>üíö Megsp√≥rolt √∂sszeg</span><b id="totalSaved">0 Ft</b></div>
        <div><span>üí∏ Elk√∂lt√∂tt √∂sszeg</span><b id="totalSpent">0 Ft</b></div>
        <div><span class="muted">üßÆ Nett√≥</span><b id="net">0 Ft</b></div>
      </div>
      <h3 style="margin:10px 0 6px">Megsp√≥rolt t√©telek</h3>
      <ul class="list" id="savedList"></ul>

      <h3 style="margin:12px 0 6px">Megvett t√©telek</h3>
      <ul class="list" id="spentList"></ul>

      <div class="row" style="margin-top:12px">
        <button class="btn blue" data-view="calc">Vissza a kalkul√°torhoz</button>
        <button class="btn gray" id="clearAll">Lista √ºr√≠t√©se</button>
      </div>
    </section>

    <!-- STATS -->
    <section id="view-stats" class="card hidden">
      <h2>Statisztika</h2>
      <div class="stat-legend">
        <span class="dot green"></span><span class="hint">Megsp√≥rolt</span>
        <span class="dot red" style="margin-left:12px"></span><span class="hint">Megvett</span>
      </div>
      <canvas id="statsCanvas" width="640" height="360" style="width:100%;height:auto;border-radius:12px;background:#ffffff08"></canvas>
      <p class="hint center">Havi bont√°s az eddigi t√©teleidb≈ël (Ft).</p>
    </section>

    <footer>¬© 2025 Munka√≥ra ‚Ä¢ Ap√°dhelyett Any√°d üòè</footer>
    <div id="coach" class="bubble hidden"></div>
  </div>

<script>
/* ================== UTIL + DATA ================== */
const $ = sel => document.querySelector(sel);
const $$ = sel => [...document.querySelectorAll(sel)];
const fmtFt = v => new Intl.NumberFormat("hu-HU",{style:"currency",currency:"HUF",maximumFractionDigits:0}).format(Number(v||0));
const esc = s => (s||"").replace(/[&<>"']/g, m=>({ "&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;" }[m]));
const Data = {
  get(k){ try{ const v=localStorage.getItem(k); return v?JSON.parse(v):null }catch(e){ return null } },
  set(k,v){ try{ localStorage.setItem(k, JSON.stringify(v)); return true }catch(e){ return false } },
  clear(){ ["profile","saved","spent"].forEach(k=>localStorage.removeItem(k)) }
};

/* ================== THEME ================== */
const themeToggle = $("#themeToggle");
const modeLabel = $("#modeLabel");
function applyTheme(theme){
  document.documentElement.setAttribute("data-theme", theme);
  themeToggle.checked = theme==="dark";
  modeLabel.textContent = theme==="dark" ? "S√∂t√©t" : "Vil√°gos";
  localStorage.setItem("theme", theme);
}
applyTheme(localStorage.getItem("theme") || "light");
themeToggle.addEventListener("change", ()=> applyTheme(themeToggle.checked?"dark":"light"));

/* ================== TABS / VIEWS ================== */
const tabs = $$(".tab");
const views = {
  profile: $("#view-profile"),
  calc: $("#view-calc"),
  results: $("#view-results"),
  stats: $("#view-stats"),
};
function setView(name){
  tabs.forEach(t=>t.classList.toggle("active", t.dataset.view===name));
  Object.entries(views).forEach(([k,el])=> el.classList.toggle("hidden", k!==name));
  if(name==="calc") syncHello();
  if(name==="results") renderResults();
  if(name==="stats") drawStats();
  window.scrollTo({top:0, behavior:"smooth"});
}
tabs.forEach(t=> t.addEventListener("click", ()=> setView(t.dataset.view)));
$$('[data-view="calc"]').forEach(btn=> btn.addEventListener("click", ()=> setView("calc")));

/* ================== COACH MESSAGES (100+) ================== */
const COACH = [
"Ejnye, ez√©rt most sokat fogsz dolgozni. üò¨","A p√©nzt√°rc√°d halk s√≠r√°st hallatott. üí∏","A j√∂v≈ëbeli √©ned most cs√≥v√°lja a fej√©t.",
"Ha boldogg√° tesz, ok√© ‚Äì de sok √≥r√°dba ker√ºl.","Ez m√°r a 'dr√°ga, de kell' kateg√≥ria? ü§®","A banksz√°ml√°d szabads√°gra ment.",
"10 √≥r√°n t√∫l? Any√°d felh√≠vna. ü´®","Legk√∂zelebb √≠rd be: 'gondolkozzak m√©g'.","A racionalit√°s most eb√©del. üçΩÔ∏è","Legal√°bb sz√©p lesz. Rem√©lj√ºk.",
"Ez egy hossz√∫ m≈±szak √°ra. ‚è≥","Instant dopamin, tart√≥s m√≠nusz. ‚ö°Ô∏è","A lelkiismereted most offline.","K√°v√© helyett most dolgozol √©rte m√©g p√°rat.",
"Nem musz√°j, de megtetted. üòÖ","A matek nem tapsol most. üßÆ","Ezen most a p√©nz√ºgyi coach felszisszent.","Ok√©, de haszn√°ld is naponta!",
"A j√≥zan √©sz most AFK. üì¥","Ha meghozn√°d √∫jra ezt a d√∂nt√©st? Biztos?","Egy t√©tel, k√©t s√≥haj. üòÆ‚Äçüí®","Ez a 'sz√≠v d√∂nt√∂tt' v√°s√°rl√°s.",
"Minimum egy h√©tv√©ge ment r√°.","Nem rossz, csak‚Ä¶ dr√°ga.","Ha akci√≥s volt, kicsit kev√©sb√© f√°j.","A 'majd visszateszem' gomb letiltva? üòè",
"Ezt a d√∂nt√©st screenshotolom a tanmes√©hez. üì∏","Kis l√©p√©s a t√°rgy fel√©, nagy l√©p√©s a m√≠nuszba.","√ârzed azt a kis b√∂k√©st? Az a bankk√°rtya. üí≥",
"Na‚Ä¶ legal√°bb sztori lesz. üìñ","A sp√≥rol√°s most sz√ºnetel. üßò","Ha ezt megsp√≥roltad volna‚Ä¶","Ez m√°r 'luxus-szag√∫' d√∂nt√©s. üíé",
"A j√∂v≈ë heti eb√©ded integet. üçù","10+ √≥ra? Ez m√°r szerelem.","Tudod, hogy ez√©rt t√∫l√≥r√°zol majd?","A k√∂lts√©gvet√©sed most k√©r egy √∂lel√©st.",
"Ez a v√°s√°rl√°s besz√©lget√©st √©rdemel.","A m√©rleg: √∂r√∂m + b≈±ntudat = egyenleg?","Az √©sz helyett a szem d√∂nt√∂tt. üëÄ","Valaki most nagyon boldog (a keresked≈ë).",
"Rem√©lj√ºk legal√°bb tart√≥s.","Ha ez motiv√°l a munk√°ra ‚Äì rendben. üí™","P√©nz√ºgyi edz√©s: ma farizom + p√©nzt√°rca.","Ezt a 'sz√ºks√©ges' sz√≥t feszegetj√ºk.",
"A sp√≥rol√°sod most leveg≈ët vesz.","Kedves, de k√∂lts√©ges.","A 'csak megn√©zem' ut√°n ez lett. üõí","√ân sz√≥ltam volna‚Ä¶ ha k√©rdezel. üòâ",
"Egy t√°rgy, sok √≥ra. J√≥ csere?","A fej sz√°mol, a sz√≠v v√°s√°rol.","Ha ezt b√©rben m√©rn√©nk, sok lenne.","Majd amikor j√∂n a rezsi, eml√©kezz. üßæ",
"Ez m√°r 'feln≈ëtt d√∂nt√©s' ‚Äì √°ra van.","A bankod is l√°tta ezt, ugye? üëÄ","Ha ez √∂r√∂m√∂t hoz, ok√© ‚Äì de sokba ker√ºlt.","Instant j√≥ √©rz√©s, k√©sleltetett f√°j√°s.",
"Nem baj, tanul√≥p√©nz. Dr√°ga tanul√≥p√©nz.","Anyai s√≥haj: *hosszan*. üòÆ‚Äçüí®","Ha ezt eladn√°d k√©s≈ëbb‚Ä¶ k√©rd√©ses.","Ez m√°r 'j√≥, de musz√°j volt?' kateg√≥ria.",
"K√∂vetkez≈ëre √≠rj list√°t. üìù","A hat√°rid≈ëk is integetnek most. ‚è∞","A sp√≥rol√°sod megbicsaklott.","A p√©nzed kicsit elszaladt k√°v√©zni. ‚òï",
"Egy 'majd legk√∂zelebb' gomb hi√°nyzott.","Ezt a d√∂nt√©st a j√∂v≈ëbeli te √©rt√©kelni fogja? ü§î","Tarts egy 24 √≥r√°s szab√°lyt legk√∂zelebb.",
"Most m√°r legal√°bb motiv√°lt vagy dolgozni. üòÖ","A k√∂lts√©gvet√©sed k√©r egy meetinget. üìä","Ez k√©rem pr√©selt munka√≥r√°kb√≥l k√©sz√ºlt. üîß",
"A hitelk√°rty√°d halkan remeg.","Ez az √©lm√©ny rem√©lj√ºk nem m√∫l√≥.","Ha ezt egyszer≈±en 'kellett' ‚Äì j√≥ van.","Az √©sz: 'nem', a v√°gy: 'igen'.",
"A p√©nz√ºgyi hat√°r most kicsit cs√∫szott.","A 'sp√≥rolom' gomb is ott volt √°m.","Kicsit t√∂bb lett, mint 'apr√≥'.","Legal√°bb kipip√°lhatsz valamit a list√°n.",
"Gondold √°t: 10+ √≥ra = ez a t√°rgy.","A kompromisszumok dr√°g√°k.","A minimalizmus most elfordult. üßò‚Äç‚ôÇÔ∏è","Na j√≥l van, de most sp√≥rol√≥s h√©t j√∂n!",
"A p√©nz√ºgyi √©n-ed most s√≠r.","Ha ez hobbi: ok√©. Ha h√≥bort: k√©tszer gondold √°t.","A 'mi√©rt' er≈ësebb volt, mint a 'mennyi'.",
"Egy kis b≈±ntudat, egy nagy doboz. üì¶","K√∂zelebb ker√ºlt√©l hozz√° ‚Äì a banksz√°mla t√°volabb.","Az √°r-√©rt√©k ar√°ny most vitatott.",
"Ez a 'meg√©rdemlem' pillanat?","Jutalomv√°s√°rl√°s? Akkor hajr√° ‚Äì ritk√°n.","A t√ºrelem gyakran olcs√≥bb. ‚è≥","A 'most azonnal kell' a legdr√°g√°bb.",
"Ha a munk√°d boldogg√° tesz ‚Äì megdolgozt√°l √©rte.","A j√∂v≈ëbeli sz√°ml√°k nem felejtenek.","A keret csipogott. üìâ","A d√∂nt√©s megvan ‚Äì most haszn√°ld is, sokat!",
"Minimum 10 √≥ra ‚Äì maximum √∂r√∂m?","Ha ez inspir√°l: nyert√©l. Ha nem: tanult√°l.","Ok√©, de a k√∂vetkez≈ë legyen 'Megsp√≥rolom'.",
"A bankod eddig b√≠rta nevet√©s n√©lk√ºl. üò¨","Minden rendben ‚Äì csak most kicsit dr√°ga lett.","A sp√≥rol√°sod most visszasz√°mol.",
"Ezt m√©g Any√°d is megk√©rdezn√©: kellett?","Z√°rjuk le: haszn√°ld eg√©szs√©ggel, okosan. ‚úÖ"
];

/* ================== PROFILE ================== */
const nameEl=$("#name"), ageEl=$("#age"), salaryEl=$("#salary"), hoursEl=$("#hours");
const saveBtn=$("#saveProfile"), delBtn=$("#deleteProfile");
function loadProfile(){
  const p = Data.get("profile"); if(!p) return;
  nameEl.value=p.name||""; ageEl.value=p.age||""; salaryEl.value=p.salary||""; hoursEl.value=p.hours||"";
}
function saveProfile(){
  const p = { name: nameEl.value.trim(), age: Number(ageEl.value), salary: Number(salaryEl.value), hours: Number(hoursEl.value) };
  if(!p.name || !p.age || !p.salary || !p.hours){ alert("T√∂lts ki minden mez≈ët!"); return; }
  Data.set("profile", p);
  if(!Data.get("saved")) Data.set("saved", []);
  if(!Data.get("spent")) Data.set("spent", []);
  setView("calc");
}
function deleteProfile(){
  if(!confirm("Biztos t√∂rl√∂d a profilodat √©s a list√°kat?")) return;
  Data.clear(); nameEl.value=ageEl.value=salaryEl.value=hoursEl.value="";
  setView("profile");
}
saveBtn.addEventListener("click", saveProfile);
delBtn.addEventListener("click", deleteProfile);

/* ================== CALCULATOR ================== */
const hello=$("#hello"), hourlyHint=$("#hourlyHint");
const productName=$("#productName"), productPrice=$("#productPrice");
const calcBtn=$("#calculateBtn"), calcResult=$("#calcResult"), hoursText=$("#workHoursText");
const saveChoice=$("#saveBtn"), buyChoice=$("#buyBtn");

function syncHello(){
  const p = Data.get("profile");
  if(!p){ hello.textContent="Szia! T√∂ltsd ki a profilod a pontos sz√°m√≠t√°shoz."; return; }
  hello.innerHTML = `Szia <b>${esc(p.name||"")}</b>! N√©zz√ºk meg, h√°ny √≥r√°dba ker√ºlne.`;
}
function calculate(){
  const p = Data.get("profile");
  if(!p){ setView("profile"); return; }
  const name = productName.value.trim();
  const price = Number(productPrice.value);
  if(!name || !price || price<=0){ alert("Add meg a term√©k nev√©t √©s √°r√°t!"); return; }
  const hourly = p.salary / (p.hours*4);
  if(!hourly || hourly<=0){ alert("√ârv√©nytelen profil adatok."); return; }
  const h = price / hourly;
  hourlyHint.textContent = `Jelenlegi √≥rab√©red ~ ${fmtFt(hourly)}/√≥ra`;
  hoursText.textContent = `Kb. ${h.toFixed(1)} munka√≥r√°dba ker√ºlne (${fmtFt(price)}).`;
  calcResult.dataset.name=name; calcResult.dataset.price=String(price); calcResult.dataset.hours=String(h);
  calcResult.classList.remove("hidden");
}
calcBtn.addEventListener("click", calculate);

function commit(type){
  const name = calcResult.dataset.name;
  const price = Number(calcResult.dataset.price);
  const hours = Number(calcResult.dataset.hours);
  if(!name || !price){ alert("El≈ëbb sz√°molj!"); return; }
  const list = Data.get(type)||[];
  list.unshift({name, price, hours, at: Date.now(), type});
  Data.set(type, list);
  if(type==="spent" && hours>10){ showCoach(); } else { setView("results"); }
}
saveChoice.addEventListener("click", ()=>commit("saved"));
buyChoice.addEventListener("click", ()=>commit("spent"));

function showCoach(){
  const b=$("#coach");
  b.textContent="Ap√°dhelyett Any√°d: " + COACH[Math.floor(Math.random()*COACH.length)];
  b.classList.remove("hidden");
  setTimeout(()=>{ b.classList.add("hidden"); setView("results"); }, 2400);
}

/* ================== RESULTS ================== */
const savedList=$("#savedList"), spentList=$("#spentList");
const totalSaved=$("#totalSaved"), totalSpent=$("#totalSpent"), net=$("#net");
const clearAll=$("#clearAll");

function renderResults(){
  const saved=Data.get("saved")||[], spent=Data.get("spent")||[];
  savedList.innerHTML=""; spentList.innerHTML="";
  let s=0,e=0;
  saved.forEach((it,idx)=>{
    s+=Number(it.price);
    const li=document.createElement("li"); li.className="item";
    li.innerHTML=`<span><span class="badge b-green">sp√≥rolt</span> <span class="name">${esc(it.name)}</span></span>
                  <span class="price">${fmtFt(it.price)}</span>`;
    savedList.appendChild(li);
  });
  spent.forEach((it,idx)=>{
    e+=Number(it.price);
    const li=document.createElement("li"); li.className="item";
    li.innerHTML=`<span><span class="badge b-red">vett</span> <span class="name">${esc(it.name)}</span></span>
                  <span class="price">${fmtFt(it.price)}</span>`;
    spentList.appendChild(li);
  });
  totalSaved.textContent=fmtFt(s);
  totalSpent.textContent=fmtFt(e);
  net.textContent=fmtFt(s-e);
}
clearAll.addEventListener("click", ()=>{
  if(!confirm("Biztos √ºr√≠ted a list√°t?")) return;
  Data.set("saved", []); Data.set("spent", []); renderResults(); drawStats();
});

/* ================== STATS (canvas, monthly) ================== */
const cvs = $("#statsCanvas");
const ctx = cvs.getContext("2d");

function monthKey(ts){
  const d=new Date(ts); return d.getFullYear()+"-"+String(d.getMonth()+1).padStart(2,"0");
}
function aggregateMonthly(){
  const map = new Map();
  (Data.get("saved")||[]).forEach(it=>{
    const k=monthKey(it.at||Date.now()); const o=map.get(k)||{saved:0, spent:0}; o.saved+=Number(it.price)||0; map.set(k,o);
  });
  (Data.get("spent")||[]).forEach(it=>{
    const k=monthKey(it.at||Date.now()); const o=map.get(k)||{saved:0, spent:0}; o.spent+=Number(it.price)||0; map.set(k,o);
  });
  const arr = [...map.entries()].sort((a,b)=> a[0]>b[0]?1:-1).slice(-8); // last 8 months
  return { labels: arr.map(x=>x[0]), saved: arr.map(x=>x[1].saved), spent: arr.map(x=>x[1].spent) };
}
function drawStats(){
  const d = aggregateMonthly();
  // clear
  ctx.clearRect(0,0,cvs.width,cvs.height);
  // axes
  const P={l:48, r:20, t:14, b:40}; const W=cvs.width-P.l-P.r; const H=cvs.height-P.t-P.b;
  ctx.strokeStyle = getComputedStyle(document.documentElement).getPropertyValue("--line");
  ctx.lineWidth=1; ctx.beginPath(); ctx.moveTo(P.l,P.t); ctx.lineTo(P.l,P.t+H); ctx.lineTo(P.l+W,P.t+H); ctx.stroke();
  // scale
  const maxVal = Math.max(1000, ...d.saved, ...d.spent);
  const y = v => P.t + H - (v/maxVal)*H;
  const barW = W / Math.max(1, d.labels.length) / 2.2;
  // bars
  for(let i=0;i<d.labels.length;i++){
    const x0 = P.l + i*(W/d.labels.length) + 8;
    // saved (green)
    ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue("--green");
    ctx.fillRect(x0, y(d.saved[i]), barW, (P.t+H)-y(d.saved[i]));
    // spent (red)
    ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue("--red");
    ctx.fillRect(x0+barW+6, y(d.spent[i]), barW, (P.t+H)-y(d.spent[i]));
    // labels
    ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue("--muted");
    ctx.font="12px system-ui"; ctx.textAlign="center";
    ctx.fillText(d.labels[i], x0+barW/2+3, P.t+H+16);
  }
}

/* ================== INIT ================== */
loadProfile();
setView(Data.get("profile") ? "calc" : "profile");
syncHello();
</script>
</body>
</html>
